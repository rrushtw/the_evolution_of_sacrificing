services:
  simulator:
    build: # 使用當前目錄的 Dockerfile
      context: .
      dockerfile: Dockerfile
    container_name: sacrificing_simulator
    restart: on-failure:5 # 如果失敗 (例如 Python 腳本崩潰)，最多重試 5 次
    volumes:
      # 1. 掛載策略資料夾 (您可以在本地修改/新增/刪除 .py，容器會即時讀取)
      - ./strategies:/app/strategies
      # 2. 掛載結果資料夾 (容器內產生的 JSON 會出現在您本地的 ./output)
      - ./output:/app/output
    environment:
      # --- 核心參數 ---
      - GRID_SIZE=60
      - NOISE=0.05
      # 每一種生物初始的數量
      - INITIAL_COPIES_PER_TYPE=20

      # --- 遊戲長度控制 ---
      # 最大回合同時也是強制停止點
      - ROUNDS_PER_GAME=1000

      # --- 穩態判定 (提早結束) ---
      # 連續幾代沒有變化視為穩定？
      - STABILITY_WINDOW=50
      # 容許的波動範圍 (隻)
      - STABILITY_TOLERANCE=3

      # 確保 Python 輸出不被緩存，即時看到日誌
      - PYTHONUNBUFFERED=1
